@startuml
namespace clase {

    abstract class Clase <<Entidad>>  #baf5ba {
      - id: string
      - titulo : string
      - descripcion : string
      - precio : float
      - presencialidad : ePresencialidad
      - imagenPortada : string
      - nivel : eNivel
    }

    class Taller <<Entidad>> #baf5ba extends Clase  {
      - duracionHoras : int
      - fechaRealizacion: LocalDate
      - horaComienzo: LocalTime
    }

    class Curso <<Entidad>> #baf5ba extends Clase  {
      - fechaInicio : LocalDate
      - fechaFin : LocalDate
    }

    class Material <<Agregado>> #baf5ba {
      - id: string
      - nombre: string
      - url: string
    }

    enum ePresencialidad #baf5ba {
      online
      presencial
    }

    enum eNivel #baf5ba {
      principiante
      intermedio
      avanzado
    }
}

' clase, pago, ejercicio
namespace usuario {

    abstract class Usuario <<Entidad>> #baecf5 {
      - id: string
      - usuario: string
      - password: string
      - nombre: string
      - apellidos: string
      - dni: string
      - email : string
      - numeroTelefono: string
      + resetearpassword()
    }

    class Profesor <<Entidad>> #baecf5 extends Usuario  {
    }

    class Alumno <<Entidad>> #baecf5 extends Usuario {
      - fechaInscripcion: LocalDateTime
      - matriculado: boolean
    }

    class Administrador <<Entidad>> #baecf5 extends Usuario {

    }

    note right of Usuario::password
    La password se encriptaria
    con BCryptPasswordEncoder

    El reseteo debería funcionar
    mediante email
    end note

    note as N
    La matricula viene
    derivada de un pago
    Un alumno tiene una matrícula
    anual pagada una vez por año
    end note

    N . Alumno
    Administrador -up[hidden]- N
}

' usuario
namespace pago {

    class Pago <<Entidad>> #ffd5ba {
      - id: string
      - fechaPago : LocalDateTime
      - importe : float
      - metodoPago : eMetodoPago
      - estado: eEstadoPago
      - alumnoId: string
    }

    class ItemPago <<Agregado>> #ffd5ba {
      - id: string
      - concepto: string
      - precioUnitario: float
      - cantidad: int
      - pagoId: string
    }

    enum eMetodoPago #ffd5ba {
      efectivo
      debito
      credito
      transferencia
    }

    enum eEstadoPago #ffd5ba {
      exito
      error
      reenbolsado
    }

    note bottom of Pago
    Un admin o profesor puede
    registrar un pago manualmente
    que se haya hecho en metálico
    end note

    note bottom of Pago
    Una entidad pago solo se crea
    cuando se devuelva la
    confirmacion de Stripe
    end note

    note right of Pago::facturaCreada
    No se puede crear una
    factura de un pago que
    ya tenga factura
    end note
}

namespace ejercicio {
    class Ejercicio <<Entidad>> #ffdbfe {
      - id: string
      - nombre: string
      - enunciado: string
      - fechaInicioPlazo: LocalDateTime
      - fechaFinalPlazo: LocalDateTime
    }

    class EntregaEjercicio <<Entidad>> #ffdbfe {
      - id: string
      - nota: float
      - fechaEntrega: LocalDateTime
      - estado: eEstadoEjercicio
    }

    enum eEstadoEjercicio #ffdbfe {
      pendiente
      entregado
      calificado
    }
}

Clase::material *- Material
EntregaEjercicio -- Ejercicio
ItemPago -* Pago::items

' Relaciones Enums
eMetodoPago .. Pago
ePresencialidad .. Clase
eNivel .. Clase
eEstadoPago .. Pago
eEstadoEjercicio .. EntregaEjercicio

@enduml